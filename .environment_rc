##
#    ~/.environment_rc
#
#  Used to configure all my POSIX compatible shells.
#  Not used for fish.
#
#  Configure initial values of $PATH and environment
#  variables you wish child processes, perhaps other
#  shells, to initially inherit.
#
#  This was traditionally done in .profile or .bash_profile
#  whenever a login shell was created.  Unfortunately,
#  in many cases, there is no guarantee anymore that these
#  files were previously sourced.
#
#  Out of the blue, GNOME 3 gdm on ARCH began
#  non-interactively sourcing .profile.
#

## Sentinel value to mark completion ofan initial environment configuration
export _ENV_INITIALIZED=${_ENV_INITIALIZED:=0}
_ENV_INITIALIZED=$(( _ENV_INITIALIZED + 1 ))

## Set locale so commandline tools & other programs default to unicode
export LANG=en_US.utf8

## Construct the shell's PATH for all my different computers,
## non-existent and duplicate path elements dealt with at end.

# Save original PATH
[ -z "$VIRGIN_PATH" ] && export VIRGIN_PATH="$PATH"

# On iMac Brew installs symlinks here
PATH=/usr/local/sbin:$PATH

# If there is a ~/bin directory, put near end
PATH="$PATH":~/bin

# Put relative directories at end of PATH, this is for
# projects where the user takes up residence in the project's
# root directory.
PATH="$PATH":bin:./bin

# Ruby tool chain
#   Mostly for the Ruby Markdown linter,
#   to install linter: $ gem install mdl
if [ -d /usr/local/lib/ruby/gems ]
then
    eval PATH=/usr/local/lib/ruby/gems/*/bin:"$PATH"
fi
if [ -d ~/.local/share/gem/ruby ]
then
    eval PATH=~/.local/share/gem/ruby/*/bin:"$PATH"
fi
PATH=/usr/local/opt/ruby/bin:"$PATH"

# Location Rust Toolchain
PATH=~/.cargo/bin:"$PATH"

# SBT on iMac installed with SDKMAN
PATH=~/.sdkman/canidates/sbt/current/bin:"$PATH"

# On iMac node 16 is "Keg only"
PATH=/usr/local/opt/node@16/bin:"$PATH"

# On iMac, put brew clang before system clang (for clangd language server)
PATH=/usr/local/opt/llvm/bin:"$PATH"

# Utilities I want to overide everything
PATH=~/.local/bin:~/opt/bin:"$PATH"

# Python configuration
export PIP_REQUIRE_VIRTUALENV=true

# Configure Java for Sway/Wayland on ARCH
if uname -r | grep -q arch
then
    PATH=/usr/lib/jvm/java-17-openjdk/bin:"$PATH"
    export _JAVA_AWT_WM_NONREPARENTING=1
fi

## Clean up PATH
PATH="$(pathtrim)"

## Setup editors/pagers
if digpath -q nvim
then
    export EDITOR=nvim
    export VISUAL=nvim
    export MANPAGER='nvim +Man!'
    export PAGER='nvim -R'
elif digpath -q vim
then
    export EDITOR=vim
    export VISUAL=vim
else
    export EDITOR=vi
    export VISUAL=vi
fi
