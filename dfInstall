#!/bin/sh
#  Installs ani entire Linix desktop environment into $HOME directory
#  uses the following GitHub repos as submodules:
#
#    grscheller/home
#    grscheller/fish
#    grscheller/nvim
#    grscheller/sway-env
#

repoName=dotfiles
scriptName=dfInstall

XDG_CONFIG_HOME="${XDG_CONFIG_HOME:=$HOME/.config}"
DOTFILE_GIT_REPO="${DOTFILE_GIT_REPO:=$HOME/devel/dotfiles}"
umask 0022

cd "$DOTFILE_GIT_REPO" || {
   printf '\n%s: Error - failed to cd into "%s"\n' "$scriptName" "$DOTFILE_GIT_REPO"
   return 1
}

## Parse cmdline arguments and source functions
switch=''
. ./installSource.sh

## Installation configuration

CONFIG_FILES='
   git/config
'

RM_TARGET_ITEMS="
   $HOME/.gitconfig
"

DIRS_TO_CREATE=""

## Install/Check

# Install miscellaneous $XDG_CONFIG_HOME configuration files
ensure_dir "$XDG_CONFIG_HOME"
chmod 0755 "$XDG_CONFIG_HOME"
install_files "$XDG_CONFIG_HOME" "$CONFIG_FILES" ./config 0644

# Remove/report no longer needed files and directories
remove_items "$RM_TARGET_ITEMS"

# Create/report missing directories
ensure_dirs "$DIRS_TO_CREATE"

# Adjustments/tweaks/tasks
case "$switch" in
   install)
      :
      ;;
   repo)
      # Get git status info on repo
      printf '\n%s git status:\n' "$repoName"
      git status -s
      ;;
   target)
      :
      ;;
esac

## Install git submodules boldly in parallel in a single instance of dash
(FISH_GIT_REPO="${DOTFILE_GIT_REPO}/config/fish"; . ./config/fish/fishInstall) &
(NVIM_GIT_REPO="${DOTFILE_GIT_REPO}/config/nvim"; . ./config/nvim/nvInstall) &
(HOME_GIT_REPO="${DOTFILE_GIT_REPO}/home"; . ./home/homeInstall) &
(SWAY_GIT_REPO="${DOTFILE_GIT_REPO}/sway-env"; . ./sway-env/swayInstall) &
