#!/bin/sh
#
#  Bootstraps packer.nvim by installing it into the right place.
#
#  This script a bit heavy handed if all you did
#  was update ~/.config/nvim/lua/grs/util/packer.lua.
#  In that case all just run
#
#      :PackerSync
#
#  and then restart Neovim.
#

PackerCloneDir="${XDG_DATA_HOME:-$HOME/.local/share}"/nvim/site/pack/packer/start/packer.nvim/
PackerCompiled="${XDG_CONFIG_HOME:-$HOME/.config}"/nvim/plugin/packer_compiled.lua
PackerGIT=https://github.com/wbthomason/packer.nvim

test -d "$PackerCloneDir" && {
    chmod -R u+rw "$PackerCloneDir"
    rm -r "$PackerCloneDir" ||
        printf 'Failed to removed existing "%s" directory.\n' "$PackerCloneDir"
}

test -f "$PackerCompiled" && {
    chmod u+rw "$PackerCompiled"
    rm -r "$PackerCompiled" ||
        printf 'Failed to removed existing "%s" file.\n' "$PackerCompiled"
}

if git clone --depth 1 $PackerGIT "$PackerCloneDir"
then
    printf '\nUpdating Packer plugins...\n'
    nvim --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync'
    printf '\n\nUpdating Mason packages...\n'
    nvim --headless -c 'autocmd User MasonUpdateAllComplete quitall' -c 'MasonUpdateAll'
    printf '\n\nDone!!!\n'
else
    printf 'Error: "git clone" failed for "%s"\n' $PackerGIT
fi
